# 💩 爆走！うんちドリル 🚽

中学2年生向けの超派手で楽しい学習クイズゲームです！5教科（英・数・国・理・社）の問題を解いて、うんちレーサーと一緒にゴール（黄金のトイレ）を目指しましょう！

## 🎮 ゲームの特徴

- **5教科対応**: 英語、数学、国語、理科、社会
- **豊富な問題数**: 各単元100問以上、合計2500問以上
- **苦手問題優先出題**: 間違えた問題を優先的に出題する賢いアルゴリズム
- **詳しい解説**: 不正解時に即座に解説が表示される
- **成績管理**: カレンダー、グラフ、単元別で学習記録を可視化
- **派手な演出**: パーティクルエフェクト、豪華なアニメーション、強化された効果音
- **シンプルなデータ構造**: 問題の追加・編集が簡単
- **軽快な動作**: Vanilla JavaScriptで実装、高速起動

## 📁 ファイル構成

```
/workspace/
├── index.html        # メインHTMLファイル
├── styles.css        # スタイルシート
├── app.js           # メインアプリケーションロジック
├── questions/       # 問題データフォルダ
│   ├── index.json   # 問題ファイルのリスト
│   ├── english-grammar-basic.json     # 英語：be動詞・一般動詞
│   ├── math-polynomial.json           # 数学：多項式の加法・減法
│   ├── japanese-kanji-reading.json    # 国語：漢字の読み
│   ├── science-force.json             # 理科：力と運動
│   └── social-japan-geography.json    # 社会：日本の地理
└── README.md        # このファイル
```

## 🚀 セットアップ方法

1. このディレクトリのファイルをWebサーバーに配置するか、ローカルでHTMLファイルを開きます

2. ブラウザで `index.html` を開く

3. すぐにプレイ可能！

## 🎯 使い方

### 1. トップ画面
- **ドリル開始**: クイズを始める
- **成績グラフ**: 学習記録を見る
- **設定**: BGM/効果音のオン・オフ、下ネタあり/なし、データリセット

### 2. ドリル設定
1. **科目選択**: 英語、数学、国語、理科、社会から選ぶ
2. **単元選択**: 学習したい単元をチェック（複数選択可）
3. **問題数選択**: 10問、20問、50問、全問から選ぶ
4. **レース開始**: クイズがスタート！

### 3. クイズ画面
- 問題に答えて、うんちレーサーを進める
- 正解すると「スッキリ！」と前進
- 不正解だと「ウッ...」と失速し、解説が表示される
- **下ネタ機能**: 設定でONにすると、約50%の確率で選択肢の1つが面白い下ネタに置き換わります（不正解選択肢のみ）

### 4. リザルト画面
- 正答数、正答率、かかった時間、獲得U-P（うんちポイント）を表示

### 5. 成績グラフ画面
- **カレンダー**: 学習した日に💩マークが表示される
- **グラフ**: 日別・週別・月別の学習量と正答率を表示
- **単元別**: 各単元の正答率を一覧表示

## 🧠 苦手問題優先出題アルゴリズム

このゲームの最大の特徴は、**間違えやすい問題を優先的に出題する**機能です。

### 仕組み
1. 各問題の解答履歴（解いた回数、正解回数）を記録
2. 正答率を計算（正解回数 ÷ 解いた回数）
3. 優先度スコア = (1 - 正答率) × 10 を計算
4. 優先度スコアに基づいて重み付けランダム抽選

### 効果
- 正答率が低い問題ほど高頻度で出題される
- 同じ問題ばかり出ることは避けられる
- 効率的に弱点を克服できる

## 💾 データ保存

すべてのデータはブラウザの `localStorage` に保存されます：

- **解答履歴**: 各問題の正答率
- **日別学習記録**: 日付ごとの問題数と正答数
- **設定**: BGM/効果音/下ネタのオン・オフ

## 🎨 カスタマイズ

### 問題の追加（新仕様）

**問題データは `questions/` フォルダ内のJSONファイルとして管理されます。**

#### 新しい問題を追加する手順：

1. **新しいJSONファイルを作成**
   - `questions/` フォルダに新しいJSONファイルを作成します
   - ファイル名は例えば `english-grammar-tense.json` のように分かりやすい名前にします

2. **JSONファイルの構造**
```json
{
  "subject": "english",
  "subjectName": "英語",
  "unitId": "grammar-tense",
  "unitName": "時制（現在・過去・未来）",
  "category": "文法",
  "questions": [
    {
      "id": "eng-tense-001",
      "question": "I ___ TV yesterday.",
      "type": "multiple",
      "choices": ["watch", "watched", "watching", "will watch"],
      "answer": 1,
      "explanation": "yesterday（昨日）があるので過去形の \"watched\" を使います。"
    }
  ]
}
```

3. **index.json に追加**
   - `questions/index.json` を開いて、`files` 配列に新しいファイル名を追加します

```json
{
  "files": [
    "english-grammar-basic.json",
    "math-polynomial.json",
    "japanese-kanji-reading.json",
    "science-force.json",
    "social-japan-geography.json",
    "english-grammar-tense.json"  ← 追加
  ]
}
```

4. **完了！**
   - ページをリロードすると、新しい問題が自動的に読み込まれます

#### 問題の形式

- **type**: `"multiple"` (4択) または `"input"` (入力式)
- **answer**: 
  - `multiple` の場合: 正解選択肢のインデックス (0〜3)
  - `input` の場合: 正解の文字列
- **id**: 全問題で一意のID（例: `eng-grammar-001`）

### スタイルの変更
`styles.css` ファイルを編集することで、色やデザインをカスタマイズできます。

## 🎉 新機能（v2.0）

### 下ネタ機能 💩
- **設定でON/OFF切り替え可能**: 設定画面で「下ネタあり」トグルを切り替えられます
- **約50%の確率で置換**: 下ネタONの場合、問題の選択肢のうち1つが面白いうんちネタに置き換わります
- **不正解選択肢のみ**: 正解選択肢は絶対に置き換わりません
- **100種類以上の下ネタ**: 「やわらかいうんち」「トイレ探す人」など、クスッと笑えるバリエーション豊富な下ネタが用意されています
- **テスト済み**: 自動テストで動作が保証されています（`test_runner.js` で検証可能）

### 派手な演出機能
- **パーティクルエフェクト**: 正解時に✨、不正解時に💩のパーティクルが飛び散ります
- **強化された効果音**: 
  - 正解音：キラキラした4音階の上昇音
  - 不正解音：ブザーのような3段階の下降音
  - 完了音：ファンファーレのような6音のメロディ
- **豪華なアニメーション**:
  - タイトルが浮遊するアニメーション
  - ボタンホバー時の拡大・発光アニメーション
  - プログレスバーのキラキラ効果
  - 正解時の画面揺れと発光
  - リザルト画面のお祝いパーティクル連続発射

### シンプル化されたデータ構造
- 関数生成からJSON配列に変更
- 問題の追加が超簡単に
- コメント付きで分かりやすい構造

## 🎵 効果音

Web Audio API を使った強化された効果音が実装されています：
- **正解音**: キラキラした4音階（800Hz→1000Hz→1200Hz→1600Hz）
- **不正解音**: ブザーのような3段階の下降音（200Hz→180Hz→160Hz）
- **完了音**: ファンファーレメロディー（ド・ド・ミ・ド・ソ・ファ#）

設定画面でオン・オフ可能です。

## ✨ パーティクルエフェクト

問題に正解・不正解したとき、画面上にパーティクルが発生します：
- **正解時**: ✨絵文字とカラフルな色（金、オレンジ、ピンク、緑）のパーティクルが30個
- **不正解時**: 💩絵文字と茶色系のパーティクルが15個
- **リザルト画面**: 画面全体に連続でお祝いパーティクルが発生

パーティクルは物理演算（重力）に基づいて放物線を描いて飛び散ります。

## 📱 レスポンシブ対応

PC、タブレット、スマートフォンに対応したレスポンシブデザインです。

## 🛠️ 技術スタック

- **HTML5**: セマンティックなマークアップ
- **CSS3**: Flexbox、Grid、アニメーション
- **Vanilla JavaScript**: フレームワーク不要の軽量実装
- **localStorage**: クライアントサイドのデータ永続化
- **Web Audio API**: 効果音の生成

## 📈 今後の拡張案

- [ ] ランキング機能
- [ ] 友達と競う機能
- [ ] うんちレーサーのカスタマイズ
- [ ] より詳細な統計機能
- [ ] オンライン対戦モード

## 🎓 対象学年

中学2年生を主なターゲットとしていますが、中学1年生～3年生も楽しめる内容です。

## 📝 ライセンス

このプロジェクトはオープンソースです。自由に使用・改変してください。

## 🤝 貢献

バグ報告や機能提案は大歓迎です！

---

**楽しく学んで、テストで高得点をゲットしよう！💪📚**