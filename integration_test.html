<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çµ±åˆãƒ†ã‚¹ãƒˆ - å®Ÿéš›ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã§æ¤œè¨¼</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #8B4513;
            padding-bottom: 10px;
        }
        .test-panel {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .control-panel {
            display: flex;
            gap: 20px;
            align-items: center;
            margin: 20px 0;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 5px;
        }
        button {
            background-color: #8B4513;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 1em;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #654321;
        }
        button.danger {
            background-color: #f44336;
        }
        button.danger:hover {
            background-color: #d32f2f;
        }
        .question-display {
            border: 2px solid #8B4513;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            background: #fff9f0;
        }
        .question-text {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }
        .choices {
            display: grid;
            gap: 10px;
        }
        .choice {
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 5px;
            background: white;
            transition: all 0.3s;
        }
        .choice.poop {
            background-color: #ffebcd;
            border-color: #8B4513;
            font-weight: bold;
            color: #8B4513;
        }
        .choice.correct {
            background-color: #e8f5e9;
            border-color: #4CAF50;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-box {
            background: linear-gradient(135deg, #8B4513, #654321);
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-on {
            background-color: #4CAF50;
        }
        .status-off {
            background-color: #f44336;
        }
        .log {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            background: #fafafa;
            font-family: monospace;
            font-size: 0.85em;
            margin: 20px 0;
        }
        .log-entry {
            padding: 5px;
            border-bottom: 1px solid #eee;
        }
        .log-entry.replaced {
            background-color: #fff3cd;
        }
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: #4CAF50;
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }
    </style>
</head>
<body>
    <h1>ğŸ’© çµ±åˆãƒ†ã‚¹ãƒˆ - å®Ÿéš›ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰æ¤œè¨¼</h1>

    <div class="test-panel">
        <h2>ğŸ“Š ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çµ±è¨ˆ</h2>
        <div class="stats-grid">
            <div class="stat-box">
                <div class="stat-label">ãƒ†ã‚¹ãƒˆå›æ•°</div>
                <div class="stat-value" id="testCount">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">ç½®æ›å›æ•°</div>
                <div class="stat-value" id="replaceCount">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">ç½®æ›ç‡</div>
                <div class="stat-value" id="replaceRate">0%</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">æœŸå¾…å€¤ã¨ã®å·®</div>
                <div class="stat-value" id="deviation">0%</div>
            </div>
        </div>
    </div>

    <div class="test-panel">
        <h2>âš™ï¸ è¨­å®š</h2>
        <div class="control-panel">
            <label style="display: flex; align-items: center; gap: 10px;">
                <span><span class="status-indicator" id="statusIndicator"></span>ä¸‹ãƒã‚¿è¨­å®š:</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="explicitToggle" checked onchange="updateSettings()">
                    <span class="slider"></span>
                </label>
                <span id="statusText">ON</span>
            </label>
        </div>
        <div class="control-panel">
            <label>
                ç§‘ç›®:
                <select id="subjectSelect" onchange="loadUnits()">
                    <option value="">-- é¸æŠã—ã¦ãã ã•ã„ --</option>
                </select>
            </label>
            <label>
                å˜å…ƒ:
                <select id="unitSelect">
                    <option value="">-- ç§‘ç›®ã‚’é¸æŠã—ã¦ãã ã•ã„ --</option>
                </select>
            </label>
        </div>
        <div class="control-panel">
            <button onclick="testOnce()">ğŸ² 1å›ãƒ†ã‚¹ãƒˆ</button>
            <button onclick="testMultiple(10)">âš¡ 10å›é€£ç¶šãƒ†ã‚¹ãƒˆ</button>
            <button onclick="testMultiple(100)">âš¡âš¡ 100å›é€£ç¶šãƒ†ã‚¹ãƒˆ</button>
            <button onclick="testMultiple(1000)">âš¡âš¡âš¡ 1000å›é€£ç¶šãƒ†ã‚¹ãƒˆ</button>
            <button onclick="resetStats()" class="danger">ğŸ”„ çµ±è¨ˆãƒªã‚»ãƒƒãƒˆ</button>
        </div>
    </div>

    <div class="test-panel">
        <h2>ğŸ“ ç¾åœ¨ã®å•é¡Œ</h2>
        <div id="questionDisplay" class="question-display">
            <p style="text-align: center; color: #999;">ãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦é–‹å§‹ã—ã¦ãã ã•ã„</p>
        </div>
    </div>

    <div class="test-panel">
        <h2>ğŸ“‹ å®Ÿè¡Œãƒ­ã‚°</h2>
        <div id="log" class="log"></div>
    </div>

    <script src="data.js"></script>
    <script>
        // app.jsã‹ã‚‰å¿…è¦ãªéƒ¨åˆ†ã‚’è¤‡è£½
        let settings = { explicitContent: true };
        let testCount = 0;
        let replaceCount = 0;
        const logEntries = [];

        const POOP_JOKES = [
            'ã‚„ã‚ã‚‰ã‹ã„ã†ã‚“ã¡', 'ç¡¬ã„ã†ã‚“ã¡', 'æ¼ã‚Œãã†ãªäºº', 'èŒ¶è‰²ã„ã‚½ãƒ•ãƒˆã‚¯ãƒªãƒ¼ãƒ ',
            'ã‚³ãƒ­ã‚³ãƒ­ã†ã‚“ã¡', 'ãƒãƒŠãƒŠå‹ã†ã‚“ã¡', 'ä¸‹ç—¢æ°—å‘³ã®äºº', 'ãƒˆã‚¤ãƒ¬ã‚’æ¢ã™äºº',
            'ã‚¦ã‚©ã‚·ãƒ¥ãƒ¬ãƒƒãƒˆå¾…ã¡', 'ã†ã‚“ã¡ã‚’æˆ‘æ…¢ä¸­', 'ä»Šã™ããƒˆã‚¤ãƒ¬ãŒå¿…è¦', 'ãŠãªã‚‰æˆ‘æ…¢',
            'ãŠãªã‚‰ãŒå‡ºãã†', 'ã¶ã‚Šã¶ã‚Šã†ã‚“ã¡', 'ã‚‚ã‚Šã‚‚ã‚Šã†ã‚“ã¡', 'ã™ã‚‹ã™ã‚‹ã†ã‚“ã¡',
            'ãƒ„ãƒ«ãƒ„ãƒ«ã†ã‚“ã¡', 'ã¹ã¡ã‚ƒã¹ã¡ã‚ƒã†ã‚“ã¡', 'ã“ã‚“ã‚‚ã‚Šã†ã‚“ã¡', 'ã¨ãã‚ã‚’å·»ã„ãŸã†ã‚“ã¡',
            'ã†ã‚“ã¡5ç§’å‰', 'ã†ã‚“ã¡ã‚¿ã‚¤ãƒ ', 'ãƒˆã‚¤ãƒ¬ã®ç¥æ§˜', 'ä¾¿ç§˜3æ—¥ç›®', 'ä¾¿ç§˜1é€±é–“',
            'ãŠè…¹ã‚´ãƒ­ã‚´ãƒ­', 'ãŠãªã‹ãƒ”ãƒ¼ãƒ”ãƒ¼', 'ãã°ã£ã¦ã‚‹äºº', 'ã„ãã‚“ã§ã‚‹äºº', 'ãµã‚“ã°ã‚Šä¸­',
            'ãƒˆã‚¤ãƒ¬ãƒƒãƒˆãƒšãƒ¼ãƒ‘ãƒ¼10å·»', 'ã‚¦ã‚©ã‚·ãƒ¥ãƒ¬ãƒƒãƒˆMAX', 'éŸ³å§«ãƒ•ãƒ«ç¨¼åƒ', 'å€‹å®¤ã«é§†ã‘è¾¼ã‚€',
            'å¤§ã®æ–¹ã§ã™', 'ã—ã‚ƒãŒã¿ã“ã‚€äºº', 'ãã•ã„ã†ã‚“ã¡', 'ãã•ã„ãŠãªã‚‰', 'ã«ãŠã†ã‚„ã¤',
            'ãƒ—ãƒ³ãƒ—ãƒ³ä¸¸', 'ã‚¹ãƒ«ãƒƒã¨å‡ºãŸ', 'ã‚¹ãƒƒã‚­ãƒªã†ã‚“ã¡'
        ];

        function shuffleChoicesWithPoopJoke(choices, correctAnswerIndex) {
            const choicesWithIndex = choices.map((choice, index) => ({
                text: choice,
                isCorrect: index === correctAnswerIndex
            }));
            
            const shouldAddPoopJoke = settings.explicitContent && Math.random() < 0.5;
            
            if (shouldAddPoopJoke) {
                const wrongIndices = [];
                choicesWithIndex.forEach((item, index) => {
                    if (!item.isCorrect) {
                        wrongIndices.push(index);
                    }
                });
                
                if (wrongIndices.length > 0) {
                    const targetIndex = wrongIndices[Math.floor(Math.random() * wrongIndices.length)];
                    const randomPoopJoke = POOP_JOKES[Math.floor(Math.random() * POOP_JOKES.length)];
                    choicesWithIndex[targetIndex].text = randomPoopJoke;
                }
            }
            
            for (let i = choicesWithIndex.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [choicesWithIndex[i], choicesWithIndex[j]] = [choicesWithIndex[j], choicesWithIndex[i]];
            }
            
            let newCorrectIndex = -1;
            const shuffledChoices = choicesWithIndex.map((item, index) => {
                if (item.isCorrect) {
                    newCorrectIndex = index;
                }
                return item.text;
            });
            
            return {
                choices: shuffledChoices,
                correctIndex: newCorrectIndex,
                hadPoopJoke: shouldAddPoopJoke
            };
        }

        // åˆæœŸåŒ–
        window.onload = function() {
            loadSubjects();
            updateSettings();
        };

        function loadSubjects() {
            const select = document.getElementById('subjectSelect');
            for (const subjectId in QUESTION_DATABASE) {
                const option = document.createElement('option');
                option.value = subjectId;
                option.textContent = QUESTION_DATABASE[subjectId].name;
                select.appendChild(option);
            }
        }

        function loadUnits() {
            const subjectId = document.getElementById('subjectSelect').value;
            const unitSelect = document.getElementById('unitSelect');
            unitSelect.innerHTML = '<option value="">-- å˜å…ƒã‚’é¸æŠã—ã¦ãã ã•ã„ --</option>';
            
            if (subjectId && QUESTION_DATABASE[subjectId]) {
                const units = QUESTION_DATABASE[subjectId].units;
                for (const unitId in units) {
                    const option = document.createElement('option');
                    option.value = unitId;
                    option.textContent = units[unitId].name;
                    unitSelect.appendChild(option);
                }
            }
        }

        function updateSettings() {
            settings.explicitContent = document.getElementById('explicitToggle').checked;
            const indicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');
            
            if (settings.explicitContent) {
                indicator.className = 'status-indicator status-on';
                statusText.textContent = 'ON';
                statusText.style.color = '#4CAF50';
            } else {
                indicator.className = 'status-indicator status-off';
                statusText.textContent = 'OFF';
                statusText.style.color = '#f44336';
            }
        }

        function getRandomQuestion() {
            const subjectId = document.getElementById('subjectSelect').value;
            const unitId = document.getElementById('unitSelect').value;
            
            if (!subjectId) {
                // ãƒ©ãƒ³ãƒ€ãƒ ã«ç§‘ç›®ã‚’é¸æŠ
                const subjects = Object.keys(QUESTION_DATABASE);
                const randomSubject = subjects[Math.floor(Math.random() * subjects.length)];
                const units = Object.keys(QUESTION_DATABASE[randomSubject].units);
                const randomUnit = units[Math.floor(Math.random() * units.length)];
                
                const questions = QUESTION_DATABASE[randomSubject].units[randomUnit].questions;
                const multipleChoice = questions.filter(q => q.type === 'multiple');
                
                if (multipleChoice.length > 0) {
                    return {
                        question: multipleChoice[Math.floor(Math.random() * multipleChoice.length)],
                        subject: QUESTION_DATABASE[randomSubject].name,
                        unit: QUESTION_DATABASE[randomSubject].units[randomUnit].name
                    };
                }
            } else if (unitId) {
                const questions = QUESTION_DATABASE[subjectId].units[unitId].questions;
                const multipleChoice = questions.filter(q => q.type === 'multiple');
                
                if (multipleChoice.length > 0) {
                    return {
                        question: multipleChoice[Math.floor(Math.random() * multipleChoice.length)],
                        subject: QUESTION_DATABASE[subjectId].name,
                        unit: QUESTION_DATABASE[subjectId].units[unitId].name
                    };
                }
            } else {
                // ç§‘ç›®å†…ã®ãƒ©ãƒ³ãƒ€ãƒ ãªå˜å…ƒ
                const units = Object.keys(QUESTION_DATABASE[subjectId].units);
                const randomUnit = units[Math.floor(Math.random() * units.length)];
                const questions = QUESTION_DATABASE[subjectId].units[randomUnit].questions;
                const multipleChoice = questions.filter(q => q.type === 'multiple');
                
                if (multipleChoice.length > 0) {
                    return {
                        question: multipleChoice[Math.floor(Math.random() * multipleChoice.length)],
                        subject: QUESTION_DATABASE[subjectId].name,
                        unit: QUESTION_DATABASE[subjectId].units[randomUnit].name
                    };
                }
            }
            
            return null;
        }

        function testOnce() {
            const data = getRandomQuestion();
            if (!data) {
                alert('å•é¡ŒãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ');
                return;
            }
            
            const result = shuffleChoicesWithPoopJoke(data.question.choices, data.question.answer);
            
            // çµ±è¨ˆæ›´æ–°
            testCount++;
            if (result.hadPoopJoke) {
                replaceCount++;
            }
            updateStats();
            
            // å•é¡Œè¡¨ç¤º
            displayQuestion(data, result);
            
            // ãƒ­ã‚°è¿½åŠ 
            addLog(data, result);
        }

        async function testMultiple(count) {
            const button = event.target;
            button.disabled = true;
            
            for (let i = 0; i < count; i++) {
                testOnce();
                
                // 10å›ã”ã¨ã«UIæ›´æ–°ã‚’å¾…ã¤
                if (i % 10 === 0) {
                    await new Promise(resolve => setTimeout(resolve, 0));
                }
            }
            
            button.disabled = false;
        }

        function displayQuestion(data, result) {
            const display = document.getElementById('questionDisplay');
            
            let html = `
                <div class="question-text">${data.question.question}</div>
                <div style="margin-bottom: 15px; color: #666;">
                    <strong>${data.subject}</strong> - ${data.unit}
                </div>
                <div class="choices">
            `;
            
            result.choices.forEach((choice, index) => {
                const isCorrect = index === result.correctIndex;
                const isPoop = POOP_JOKES.includes(choice);
                const classes = ['choice'];
                if (isPoop) classes.push('poop');
                if (isCorrect) classes.push('correct');
                
                html += `
                    <div class="${classes.join(' ')}">
                        ${isPoop ? 'ğŸ’© ' : ''}${choice}${isCorrect ? ' âœ“' : ''}
                    </div>
                `;
            });
            
            html += '</div>';
            display.innerHTML = html;
        }

        function updateStats() {
            document.getElementById('testCount').textContent = testCount;
            document.getElementById('replaceCount').textContent = replaceCount;
            
            if (testCount > 0) {
                const rate = (replaceCount / testCount) * 100;
                const dev = Math.abs(rate - 50);
                document.getElementById('replaceRate').textContent = rate.toFixed(2) + '%';
                document.getElementById('deviation').textContent = dev.toFixed(2) + '%';
            }
        }

        function addLog(data, result) {
            const timestamp = new Date().toLocaleTimeString();
            const entry = `[${timestamp}] ${data.subject} - ${data.unit}: ${result.hadPoopJoke ? 'ç½®æ›ã‚ã‚Š ğŸ’©' : 'ç½®æ›ãªã—'}`;
            
            logEntries.unshift(entry);
            if (logEntries.length > 100) logEntries.pop();
            
            const log = document.getElementById('log');
            log.innerHTML = logEntries.map(e => 
                `<div class="log-entry ${e.includes('ğŸ’©') ? 'replaced' : ''}">${e}</div>`
            ).join('');
        }

        function resetStats() {
            if (confirm('çµ±è¨ˆã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
                testCount = 0;
                replaceCount = 0;
                logEntries.length = 0;
                updateStats();
                document.getElementById('log').innerHTML = '';
            }
        }
    </script>
</body>
</html>
