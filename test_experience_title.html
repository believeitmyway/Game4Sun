<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çµŒé¨“å€¤ãƒ»ç§°å·æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #8B4513;
            padding-bottom: 10px;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #ccc;
        }
        .test-result.pass {
            background-color: #e8f5e9;
            border-left-color: #4CAF50;
        }
        .test-result.fail {
            background-color: #ffebee;
            border-left-color: #f44336;
        }
        button {
            background-color: #8B4513;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 1em;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #654321;
        }
        .player-data {
            background: #fff9f0;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .player-data-item {
            margin: 5px 0;
            font-size: 1.1em;
        }
        .player-data-label {
            font-weight: bold;
            color: #8B4513;
        }
        .log {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            background: #fafafa;
            font-family: monospace;
            font-size: 0.9em;
            margin: 20px 0;
        }
        .log-entry {
            padding: 5px;
            border-bottom: 1px solid #eee;
        }
        .log-entry.success {
            color: #4CAF50;
        }
        .log-entry.error {
            color: #f44336;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª çµŒé¨“å€¤ãƒ»ç§°å·æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h1>

    <div class="test-section">
        <h2>ğŸ“Š ç¾åœ¨ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‡ãƒ¼ã‚¿</h2>
        <div id="playerData" class="player-data">
            <div class="player-data-item">
                <span class="player-data-label">ãƒ¬ãƒ™ãƒ«:</span> <span id="display-level">1</span>
            </div>
            <div class="player-data-item">
                <span class="player-data-label">çµŒé¨“å€¤:</span> <span id="display-exp">0</span> / <span id="display-exp-needed">100</span>
            </div>
            <div class="player-data-item">
                <span class="player-data-label">ç§°å·:</span> <span id="display-title">ã†ã‚“ã¡åˆå¿ƒè€…ğŸ’©</span>
            </div>
            <div class="player-data-item">
                <span class="player-data-label">U-P:</span> <span id="display-up">0</span>
            </div>
            <div class="player-data-item">
                <span class="player-data-label">é€£ç¶šæ­£è§£æ•°:</span> <span id="display-consecutive">0</span>
            </div>
            <div class="player-data-item">
                <span class="player-data-label">ã‚¹ãƒˆãƒªãƒ¼ã‚¯:</span> <span id="display-streak">0</span>æ—¥
            </div>
        </div>
        <button onclick="updateDisplay()">ğŸ”„ ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°</button>
        <button onclick="resetData()" style="background-color: #f44336;">ğŸ—‘ï¸ ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
    </div>

    <div class="test-section">
        <h2>ğŸ§ª ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</h2>
        <button onclick="runAllTests()">â–¶ï¸ å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        <button onclick="testExpGain()">âœ… çµŒé¨“å€¤ç²å¾—ãƒ†ã‚¹ãƒˆ</button>
        <button onclick="testLevelUp()">â¬†ï¸ ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ãƒ†ã‚¹ãƒˆ</button>
        <button onclick="testTitleUpdate()">ğŸ† ç§°å·æ›´æ–°ãƒ†ã‚¹ãƒˆ</button>
        <button onclick="testStreakBonus()">ğŸ”¥ ã‚¹ãƒˆãƒªãƒ¼ã‚¯ãƒœãƒ¼ãƒŠã‚¹ãƒ†ã‚¹ãƒˆ</button>
        <button onclick="testDashboard()">ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤ºãƒ†ã‚¹ãƒˆ</button>
    </div>

    <div class="test-section">
        <h2>ğŸ“ ãƒ†ã‚¹ãƒˆçµæœ</h2>
        <div id="testResults"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ“‹ å®Ÿè¡Œãƒ­ã‚°</h2>
        <div id="log" class="log"></div>
    </div>

    <script src="app.js"></script>
    <script>
        let testResults = [];
        let logEntries = [];

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const entry = `[${timestamp}] ${message}`;
            logEntries.unshift(entry);
            if (logEntries.length > 100) logEntries.pop();
            
            const logDiv = document.getElementById('log');
            logDiv.innerHTML = logEntries.map(e => 
                `<div class="log-entry ${e.includes('âœ…') ? 'success' : e.includes('âŒ') ? 'error' : ''}">${e}</div>`
            ).join('');
        }

        function updateDisplay() {
            document.getElementById('display-level').textContent = playerData.level;
            document.getElementById('display-exp').textContent = playerData.exp;
            document.getElementById('display-exp-needed').textContent = getExpForLevel(playerData.level);
            document.getElementById('display-title').textContent = playerData.title;
            document.getElementById('display-up').textContent = playerData.upPoints;
            document.getElementById('display-consecutive').textContent = playerData.consecutiveCorrect;
            document.getElementById('display-streak').textContent = streakData.currentStreak;
            log('ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ã¾ã—ãŸ', 'info');
        }

        function resetData() {
            if (confirm('å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
                localStorage.removeItem('unchiDrill_playerData');
                localStorage.removeItem('unchiDrill_streakData');
                localStorage.removeItem('unchiDrill_achievements');
                
                playerData = {
                    level: 1,
                    exp: 0,
                    upPoints: 0,
                    title: 'ã†ã‚“ã¡åˆå¿ƒè€…ğŸ’©',
                    totalQuestions: 0,
                    totalCorrect: 0,
                    consecutiveCorrect: 0,
                    bestConsecutiveCorrect: 0
                };
                
                streakData = {
                    currentStreak: 0,
                    lastStudyDate: null,
                    longestStreak: 0
                };
                
                achievements = {
                    unlocked: [],
                    progress: {}
                };
                
                updateTitle();
                updateDisplay();
                log('âœ… ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ', 'success');
            }
        }

        function addTestResult(testName, passed, message) {
            testResults.push({ name: testName, passed, message });
            const resultsDiv = document.getElementById('testResults');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${passed ? 'pass' : 'fail'}`;
            resultDiv.innerHTML = `
                <strong>${testName}</strong>: ${passed ? 'âœ… åˆæ ¼' : 'âŒ ä¸åˆæ ¼'}<br>
                <small>${message}</small>
            `;
            resultsDiv.insertBefore(resultDiv, resultsDiv.firstChild);
        }

        function testExpGain() {
            log('çµŒé¨“å€¤ç²å¾—ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...', 'info');
            const initialExp = playerData.exp;
            const initialUP = playerData.upPoints;
            
            // æ­£è§£ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
            playerData.totalQuestions++;
            playerData.totalCorrect++;
            playerData.consecutiveCorrect++;
            
            let expGained = 10;
            let upGained = 10;
            
            if (playerData.consecutiveCorrect >= 3) expGained += 5;
            if (playerData.consecutiveCorrect >= 5) expGained += 5;
            if (playerData.consecutiveCorrect >= 10) expGained += 10;
            
            const streakBonus = getStreakBonus();
            expGained = Math.floor(expGained * (1 + streakBonus.expBonus));
            upGained = Math.floor(upGained * (1 + streakBonus.upBonus));
            
            playerData.exp += expGained;
            playerData.upPoints += upGained;
            
            const expIncreased = playerData.exp > initialExp;
            const upIncreased = playerData.upPoints > initialUP;
            
            if (expIncreased && upIncreased) {
                addTestResult('çµŒé¨“å€¤ç²å¾—ãƒ†ã‚¹ãƒˆ', true, `EXP: ${initialExp} â†’ ${playerData.exp} (+${expGained}), U-P: ${initialUP} â†’ ${playerData.upPoints} (+${upGained})`);
                log(`âœ… çµŒé¨“å€¤ç²å¾—ãƒ†ã‚¹ãƒˆåˆæ ¼: EXP +${expGained}, U-P +${upGained}`, 'success');
            } else {
                addTestResult('çµŒé¨“å€¤ç²å¾—ãƒ†ã‚¹ãƒˆ', false, `EXPãŒå¢—åŠ ã—ã¦ã„ã¾ã›ã‚“: ${initialExp} â†’ ${playerData.exp}`);
                log(`âŒ çµŒé¨“å€¤ç²å¾—ãƒ†ã‚¹ãƒˆä¸åˆæ ¼`, 'error');
            }
            
            updateDisplay();
        }

        function testLevelUp() {
            log('ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...', 'info');
            const initialLevel = playerData.level;
            const initialExp = playerData.exp;
            
            // ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ã«å¿…è¦ãªçµŒé¨“å€¤ã‚’è¿½åŠ 
            const expNeeded = getExpForLevel(playerData.level);
            playerData.exp = expNeeded;
            
            const leveledUp = checkLevelUp();
            
            if (leveledUp && playerData.level === initialLevel + 1) {
                addTestResult('ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ãƒ†ã‚¹ãƒˆ', true, `ãƒ¬ãƒ™ãƒ« ${initialLevel} â†’ ${playerData.level}, EXP: ${expNeeded} â†’ ${playerData.exp}`);
                log(`âœ… ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ãƒ†ã‚¹ãƒˆåˆæ ¼: ãƒ¬ãƒ™ãƒ« ${initialLevel} â†’ ${playerData.level}`, 'success');
            } else {
                addTestResult('ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ãƒ†ã‚¹ãƒˆ', false, `ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ãŒç™ºç”Ÿã—ã¾ã›ã‚“ã§ã—ãŸ: ãƒ¬ãƒ™ãƒ« ${initialLevel}, EXP: ${playerData.exp}`);
                log(`âŒ ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ãƒ†ã‚¹ãƒˆä¸åˆæ ¼`, 'error');
            }
            
            updateDisplay();
        }

        function testTitleUpdate() {
            log('ç§°å·æ›´æ–°ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...', 'info');
            const oldTitle = playerData.title;
            
            // ãƒ¬ãƒ™ãƒ«ã‚’å¤‰æ›´ã—ã¦ç§°å·ãŒå¤‰ã‚ã‚‹ã‹ãƒ†ã‚¹ãƒˆ
            const oldLevel = playerData.level;
            playerData.level = 11;
            updateTitle();
            
            if (playerData.title !== oldTitle && playerData.title === 'ã†ã‚“ã¡ãƒã‚¹ã‚¿ãƒ¼ğŸš½') {
                addTestResult('ç§°å·æ›´æ–°ãƒ†ã‚¹ãƒˆ', true, `ç§°å·ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸ: "${oldTitle}" â†’ "${playerData.title}"`);
                log(`âœ… ç§°å·æ›´æ–°ãƒ†ã‚¹ãƒˆåˆæ ¼: "${oldTitle}" â†’ "${playerData.title}"`, 'success');
            } else {
                addTestResult('ç§°å·æ›´æ–°ãƒ†ã‚¹ãƒˆ', false, `ç§°å·ãŒæ­£ã—ãæ›´æ–°ã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ: "${playerData.title}"`);
                log(`âŒ ç§°å·æ›´æ–°ãƒ†ã‚¹ãƒˆä¸åˆæ ¼`, 'error');
            }
            
            playerData.level = oldLevel;
            updateTitle();
            updateDisplay();
        }

        function testStreakBonus() {
            log('ã‚¹ãƒˆãƒªãƒ¼ã‚¯ãƒœãƒ¼ãƒŠã‚¹ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...', 'info');
            const oldStreak = streakData.currentStreak;
            
            // ã‚¹ãƒˆãƒªãƒ¼ã‚¯ã‚’7æ—¥ã«è¨­å®š
            streakData.currentStreak = 7;
            const bonus = getStreakBonus();
            
            if (bonus.expBonus === 0.5 && bonus.upBonus === 0.25) {
                addTestResult('ã‚¹ãƒˆãƒªãƒ¼ã‚¯ãƒœãƒ¼ãƒŠã‚¹ãƒ†ã‚¹ãƒˆ', true, `7æ—¥ã‚¹ãƒˆãƒªãƒ¼ã‚¯: EXP +${(bonus.expBonus * 100).toFixed(0)}%, U-P +${(bonus.upBonus * 100).toFixed(0)}%`);
                log(`âœ… ã‚¹ãƒˆãƒªãƒ¼ã‚¯ãƒœãƒ¼ãƒŠã‚¹ãƒ†ã‚¹ãƒˆåˆæ ¼: EXP +${(bonus.expBonus * 100).toFixed(0)}%, U-P +${(bonus.upBonus * 100).toFixed(0)}%`, 'success');
            } else {
                addTestResult('ã‚¹ãƒˆãƒªãƒ¼ã‚¯ãƒœãƒ¼ãƒŠã‚¹ãƒ†ã‚¹ãƒˆ', false, `ãƒœãƒ¼ãƒŠã‚¹ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“: EXP +${(bonus.expBonus * 100).toFixed(0)}%, U-P +${(bonus.upBonus * 100).toFixed(0)}%`);
                log(`âŒ ã‚¹ãƒˆãƒªãƒ¼ã‚¯ãƒœãƒ¼ãƒŠã‚¹ãƒ†ã‚¹ãƒˆä¸åˆæ ¼`, 'error');
            }
            
            streakData.currentStreak = oldStreak;
            updateDisplay();
        }

        function testDashboard() {
            log('ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤ºãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...', 'info');
            
            // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãŒå­˜åœ¨ã™ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
            updateTopScreenDashboard();
            const dashboard = document.getElementById('top-dashboard');
            
            if (dashboard) {
                const levelEl = document.getElementById('dashboard-level');
                const titleEl = document.getElementById('dashboard-title');
                const expBar = document.getElementById('dashboard-exp-bar');
                
                if (levelEl && titleEl && expBar) {
                    const levelText = levelEl.textContent;
                    const titleText = titleEl.textContent;
                    const expWidth = expBar.style.width;
                    
                    if (levelText.includes(playerData.level.toString()) && 
                        titleText === playerData.title && 
                        expWidth) {
                        addTestResult('ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤ºãƒ†ã‚¹ãƒˆ', true, `ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™`);
                        log(`âœ… ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤ºãƒ†ã‚¹ãƒˆåˆæ ¼`, 'success');
                    } else {
                        addTestResult('ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤ºãƒ†ã‚¹ãƒˆ', false, `ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®å†…å®¹ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“`);
                        log(`âŒ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤ºãƒ†ã‚¹ãƒˆä¸åˆæ ¼`, 'error');
                    }
                } else {
                    addTestResult('ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤ºãƒ†ã‚¹ãƒˆ', false, `ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`);
                    log(`âŒ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤ºãƒ†ã‚¹ãƒˆä¸åˆæ ¼`, 'error');
                }
            } else {
                addTestResult('ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤ºãƒ†ã‚¹ãƒˆ', false, `ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`);
                log(`âŒ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤ºãƒ†ã‚¹ãƒˆä¸åˆæ ¼`, 'error');
            }
        }

        function runAllTests() {
            log('å…¨ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™...', 'info');
            document.getElementById('testResults').innerHTML = '';
            testResults = [];
            
            testExpGain();
            setTimeout(() => testLevelUp(), 100);
            setTimeout(() => testTitleUpdate(), 200);
            setTimeout(() => testStreakBonus(), 300);
            setTimeout(() => testDashboard(), 400);
            
            setTimeout(() => {
                const passed = testResults.filter(r => r.passed).length;
                const total = testResults.length;
                log(`å…¨ãƒ†ã‚¹ãƒˆå®Œäº†: ${passed}/${total} åˆæ ¼`, passed === total ? 'success' : 'error');
            }, 500);
        }

        // åˆæœŸåŒ–
        window.onload = function() {
            updateDisplay();
            log('ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ', 'info');
        };
    </script>
</body>
</html>
