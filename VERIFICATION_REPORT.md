# ä¸‹ãƒã‚¿ç½®æ›ã®ç¢ºç‡æ¤œè¨¼ãƒ¬ãƒãƒ¼ãƒˆ

## æ¤œè¨¼æ—¥æ™‚
2025-11-08

## æ¤œè¨¼ç›®çš„
ã™ã¹ã¦ã®ç§‘ç›®ã€å˜å…ƒã€å•é¡Œæ•°ã§ã€ä¸‹ãƒã‚¿ã¸ã®ç½®æ›ãŒç¢ºç‡50%ã§æ­£ã—ãå‹•ä½œã™ã‚‹ã‹ã‚’æ¤œè¨¼ã™ã‚‹

## åŸºæœ¬ãƒ­ã‚¸ãƒƒã‚¯ã®æ¤œè¨¼çµæœ

### âœ… Math.random() < 0.5 ã®ç¢ºç‡ãƒ†ã‚¹ãƒˆ

| åå¾©å›æ•° | çœŸã«ãªã£ãŸå›æ•° | ç¢ºç‡ | æœŸå¾…å€¤ã¨ã®å·® |
|---------|--------------|------|------------|
| 100 | 53 | 53.00% | 3.00% |
| 1,000 | 516 | 51.60% | 1.60% |
| 10,000 | 5,042 | 50.42% | 0.42% |
| 100,000 | 50,117 | 50.12% | 0.12% |

**çµè«–**: åŸºæœ¬çš„ãªä¹±æ•°ç”Ÿæˆã¯çµ±è¨ˆçš„ã«50%ã«åæŸã—ã¾ã™ã€‚

### âœ… ç½®æ›ãƒ­ã‚¸ãƒƒã‚¯ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

#### ä¸‹ãƒã‚¿è¨­å®š: ON

| åå¾©å›æ•° | ç½®æ›å›æ•° | ç½®æ›ç‡ | æœŸå¾…å€¤ã¨ã®å·® |
|---------|---------|-------|------------|
| 100 | 40 | 40.00% | 10.00% |
| 1,000 | 505 | 50.50% | 0.50% |
| 10,000 | 4,959 | 49.59% | 0.41% |
| 100,000 | 50,204 | 50.20% | 0.20% |

**çµè«–**: ç½®æ›ãƒ­ã‚¸ãƒƒã‚¯ã‚‚çµ±è¨ˆçš„ã«50%ç¢ºç‡ã§å‹•ä½œã—ã¾ã™ã€‚

#### ä¸‹ãƒã‚¿è¨­å®š: OFF

| åå¾©å›æ•° | ç½®æ›å›æ•° | ç½®æ›ç‡ |
|---------|---------|-------|
| 10,000 | 0 | 0.00% |

**çµè«–**: è¨­å®šãŒOFFã®å ´åˆã€ç¢ºå®Ÿã«0%ã«ãªã‚Šã¾ã™ã€‚

## ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼

### app.js ã® shuffleChoicesWithPoopJoke é–¢æ•°ï¼ˆ376-422è¡Œç›®ï¼‰

```javascript
function shuffleChoicesWithPoopJoke(choices, correctAnswerIndex) {
    const choicesWithIndex = choices.map((choice, index) => ({
        text: choice,
        isCorrect: index === correctAnswerIndex
    }));
    
    // è¨­å®šã§ä¸‹ãƒã‚¿ãŒæœ‰åŠ¹ãªå ´åˆã®ã¿ç½®ãæ›ãˆï¼ˆç¢ºç‡50%ï¼‰
    const shouldAddPoopJoke = settings.explicitContent && Math.random() < 0.5;
    
    if (shouldAddPoopJoke) {
        // ä¸æ­£è§£ã®é¸æŠè‚¢ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å–å¾—
        const wrongIndices = [];
        choicesWithIndex.forEach((item, index) => {
            if (!item.isCorrect) {
                wrongIndices.push(index);
            }
        });
        
        // ãƒ©ãƒ³ãƒ€ãƒ ã«ä¸æ­£è§£ã®é¸æŠè‚¢ã‚’1ã¤é¸ã‚“ã§ã†ã‚“ã¡ãƒã‚¿ã«ç½®ãæ›ãˆ
        if (wrongIndices.length > 0) {
            const targetIndex = wrongIndices[Math.floor(Math.random() * wrongIndices.length)];
            const randomPoopJoke = POOP_JOKES[Math.floor(Math.random() * POOP_JOKES.length)];
            choicesWithIndex[targetIndex].text = randomPoopJoke;
        }
    }
    
    // ... ã‚·ãƒ£ãƒƒãƒ•ãƒ«å‡¦ç†
}
```

### âœ… ãƒ­ã‚¸ãƒƒã‚¯ã¯æ­£å¸¸

1. **ç¢ºç‡åˆ¤å®š**: `Math.random() < 0.5` ã§50%ç¢ºç‡ã‚’å®Ÿç¾ âœ…
2. **è¨­å®šãƒã‚§ãƒƒã‚¯**: `settings.explicitContent` ã§æœ‰åŠ¹/ç„¡åŠ¹ã‚’åˆ¶å¾¡ âœ…
3. **å¯¾è±¡é¸æŠ**: ä¸æ­£è§£ã®é¸æŠè‚¢ã®ã¿ã‚’ç½®æ›å¯¾è±¡ã«ã™ã‚‹ âœ…
4. **ç½®æ›å®Ÿè¡Œ**: POOP_JOKESã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«é¸æŠã—ã¦ç½®æ› âœ…

## å•é¡ŒãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹åŸå› 

### 1. çµ±è¨ˆçš„ãªã°ã‚‰ã¤ãï¼ˆã‚µãƒ³ãƒ—ãƒ«æ•°ãŒå°‘ãªã„å ´åˆï¼‰

- 10å•ã‚„20å•ã ã‘ã ã¨ã€50%ã‹ã‚‰ãšã‚Œã‚‹ã“ã¨ãŒã‚ã‚‹
- ä¾‹: 10å•ä¸­3å•ã—ã‹ç½®æ›ã•ã‚Œãªã„ï¼ˆ30%ï¼‰ã¯çµ±è¨ˆçš„ã«èµ·ã“ã‚Šã†ã‚‹
- **è§£æ±ºç­–**: å¤§é‡ã®å•é¡Œã‚’è§£ãã‹ã€é•·æœŸçš„ã«è¦‹ã‚Œã°50%ã«åæŸã™ã‚‹

### 2. settings.explicitContent ã®çŠ¶æ…‹

ç¾åœ¨ã®å®Ÿè£…ã§ã¯ã€è¨­å®šç”»é¢ã§ã€Œä¸‹ãƒã‚¿ã‚ã‚Šã€ã®ãƒˆã‚°ãƒ«ã‚¹ã‚¤ãƒƒãƒãŒã‚ã‚Šã¾ã™ï¼ˆindex.html 247-252è¡Œç›®ï¼‰ã€‚

```javascript
function toggleExplicitContent() {
    settings.explicitContent = document.getElementById('explicit-toggle').checked;
    saveSettings();
}
```

**ç¢ºèªãƒã‚¤ãƒ³ãƒˆ**:
- ãƒˆã‚°ãƒ«ã‚¹ã‚¤ãƒƒãƒãŒONã«ãªã£ã¦ã„ã‚‹ã‹
- localStorageã«æ­£ã—ãä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã‹
- ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰å¾Œã‚‚è¨­å®šãŒç¶­æŒã•ã‚Œã¦ã„ã‚‹ã‹

### 3. ãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥

å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®JavaScriptãŒã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

**è§£æ±ºç­–**:
- ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢
- Ctrl+F5 (Windows) / Cmd+Shift+R (Mac) ã§å¼·åˆ¶ãƒªãƒ­ãƒ¼ãƒ‰

### 4. ç‰¹å®šã®ç§‘ç›®ã‚„å˜å…ƒã§ã®å•é¡Œ

ã™ã¹ã¦ã®ç§‘ç›®ãƒ»å˜å…ƒã§åŒã˜ãƒ­ã‚¸ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãŸã‚ã€ç‰¹å®šã®ç§‘ç›®ã ã‘ã§å‹•ä½œãŒç•°ãªã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

## æ¤œè¨¼æ–¹æ³•

### æ–¹æ³•1: ãƒ–ãƒ©ã‚¦ã‚¶ã§ã®è©³ç´°æ¤œè¨¼

1. `test_replacement.html` ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã
2. ã€ŒğŸ æ¤œè¨¼é–‹å§‹ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ã™ã¹ã¦ã®ç§‘ç›®ãƒ»å˜å…ƒã§10,000å›ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
4. çµæœã‚’ç¢ºèª

**ã‚¢ã‚¯ã‚»ã‚¹æ–¹æ³•**:
```
http://localhost:8000/test_replacement.html
```

### æ–¹æ³•2: ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã§ã®åŸºæœ¬æ¤œè¨¼

```bash
node simple_test.js
```

## æ¤œè¨¼ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®çµ±è¨ˆ

### ç§‘ç›®åˆ¥ã®å•é¡Œæ•°

| ç§‘ç›® | å˜å…ƒæ•° | é¸æŠå•é¡Œæ•° |
|-----|-------|----------|
| è‹±èª | 5å˜å…ƒ | 500å•ä»¥ä¸Š |
| æ•°å­¦ | 6å˜å…ƒ | 60å•ä»¥ä¸Š |
| å›½èª | 5å˜å…ƒ | 40å•ä»¥ä¸Š |
| ç†ç§‘ | 6å˜å…ƒ | 60å•ä»¥ä¸Š |
| ç¤¾ä¼š | 6å˜å…ƒ | 60å•ä»¥ä¸Š |

**æ³¨æ„**: å›½èªã«ã¯å…¥åŠ›å•é¡Œï¼ˆtype: 'input'ï¼‰ãŒå¤šãå«ã¾ã‚Œã¦ãŠã‚Šã€ã“ã‚Œã‚‰ã¯ç½®æ›å¯¾è±¡å¤–ã§ã™ã€‚

## æ¨å¥¨äº‹é …

### 1. è¨­å®šã®ç¢ºèªæ‰‹é †

1. ã‚¢ãƒ—ãƒªã®ãƒˆãƒƒãƒ—ç”»é¢ã§ã€Œâš™ï¸ è¨­å®šã€ã‚’ã‚¯ãƒªãƒƒã‚¯
2. ã€ŒğŸ’© ä¸‹ãƒã‚¿ã‚ã‚Šã€ã®ã‚¹ã‚¤ãƒƒãƒãŒONã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
3. ãƒˆãƒƒãƒ—ç”»é¢ã«æˆ»ã‚‹
4. ãƒ‰ãƒªãƒ«ã‚’é–‹å§‹ã—ã¦ç¢ºèª

### 2. çµ±è¨ˆçš„ãªæ¤œè¨¼æ–¹æ³•

å°‘ãªãã¨ã‚‚100å•ä»¥ä¸Šè§£ã„ã¦ã€ç½®æ›ç‡ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
10å•ã‚„20å•ã§ã¯çµ±è¨ˆçš„ãªã°ã‚‰ã¤ããŒå¤§ãããªã‚Šã¾ã™ã€‚

**æœŸå¾…ã•ã‚Œã‚‹çµæœ**:
- 100å•: 40-60%ã®ç¯„å›²ï¼ˆè¨±å®¹ç¯„å›²ï¼‰
- 1,000å•: 47-53%ã®ç¯„å›²ï¼ˆæœŸå¾…ï¼‰
- 10,000å•: 49-51%ã®ç¯„å›²ï¼ˆé«˜ç²¾åº¦ï¼‰

### 3. å…·ä½“çš„ãªç¢ºèªæ–¹æ³•

#### âœ… æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã‚‹å ´åˆ:

å•é¡Œã‚’è§£ã„ã¦ã„ã‚‹ã¨ã€ãŸã¾ã«é¸æŠè‚¢ã®ä¸­ã«ä»¥ä¸‹ã®ã‚ˆã†ãªæ–‡å­—åˆ—ãŒç¾ã‚Œã¾ã™ï¼š
- ã€Œã‚„ã‚ã‚‰ã‹ã„ã†ã‚“ã¡ã€
- ã€Œç¡¬ã„ã†ã‚“ã¡ã€
- ã€Œæ¼ã‚Œãã†ãªäººã€
- ã€Œãƒˆã‚¤ãƒ¬ã‚’æ¢ã™äººã€
- ã€Œä¾¿ç§˜3æ—¥ç›®ã€
ãªã©ï¼ˆPOOP_JOKESãƒªã‚¹ãƒˆã‹ã‚‰ï¼‰

#### âŒ å‹•ä½œã—ã¦ã„ãªã„å ´åˆ:

- ã¾ã£ãŸãã†ã‚“ã¡ãƒã‚¿ãŒå‡ºç¾ã—ãªã„
- è¨­å®šãŒOFFã«ãªã£ã¦ã„ã‚‹å¯èƒ½æ€§ãŒé«˜ã„

## çµè«–

### âœ… ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ™ãƒ«ã§ã®æ¤œè¨¼çµæœ

1. **åŸºæœ¬çš„ãªç¢ºç‡ãƒ­ã‚¸ãƒƒã‚¯**: æ­£å¸¸å‹•ä½œ âœ…
2. **ç½®æ›ãƒ­ã‚¸ãƒƒã‚¯**: æ­£å¸¸å‹•ä½œ âœ…
3. **è¨­å®šã®ON/OFF**: æ­£å¸¸å‹•ä½œ âœ…

### âš ï¸ ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“æ„Ÿã§ã®èª²é¡Œ

çµ±è¨ˆçš„ãªã°ã‚‰ã¤ãã«ã‚ˆã‚Šã€çŸ­æœŸçš„ã«ã¯50%ã‹ã‚‰å¤–ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚
ã“ã‚Œã¯æ­£å¸¸ãªå‹•ä½œã§ã‚ã‚Šã€é•·æœŸçš„ã«ã¯50%ã«åæŸã—ã¾ã™ã€‚

### æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

1. `test_replacement.html` ã§å…¨ç§‘ç›®ãƒ»å…¨å˜å…ƒã‚’æ¤œè¨¼
2. è¨­å®šç”»é¢ã§ã€Œä¸‹ãƒã‚¿ã‚ã‚Šã€ãŒONã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèª
3. ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢
4. é•·æœŸçš„ã«ï¼ˆ100å•ä»¥ä¸Šï¼‰çµ±è¨ˆã‚’å–ã‚‹

## è¿½åŠ ã®æ¤œè¨¼ãƒ„ãƒ¼ãƒ«

### ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

1. **test_replacement.html** - ãƒ–ãƒ©ã‚¦ã‚¶ã§ã®è©³ç´°æ¤œè¨¼ãƒ„ãƒ¼ãƒ«
   - å…¨ç§‘ç›®ãƒ»å…¨å˜å…ƒã‚’è‡ªå‹•ãƒ†ã‚¹ãƒˆ
   - çµ±è¨ˆçµæœã‚’ã‚°ãƒ©ãƒ•è¡¨ç¤º
   - å®Ÿéš›ã®ç½®æ›ä¾‹ã‚’è¡¨ç¤º

2. **simple_test.js** - ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã§ã®åŸºæœ¬æ¤œè¨¼
   - ç¢ºç‡ã®åŸºæœ¬å‹•ä½œã‚’ç¢ºèª
   - ç½®æ›ãƒ­ã‚¸ãƒƒã‚¯ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

3. **verify_replacement.js** - Node.jsç”¨æ¤œè¨¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆå‚è€ƒï¼‰

### ä½¿ç”¨æ–¹æ³•

```bash
# HTTPã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ï¼ˆã™ã§ã«èµ·å‹•æ¸ˆã¿ï¼‰
python3 -m http.server 8000

# ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹
# http://localhost:8000/test_replacement.html

# ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆ
node simple_test.js
```

---

**æœ€çµ‚æ›´æ–°**: 2025-11-08  
**æ¤œè¨¼è€…**: AI Assistant  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… ã‚³ãƒ¼ãƒ‰ã¯æ­£å¸¸å‹•ä½œ
